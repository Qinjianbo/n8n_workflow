# 京东签到领京豆工作流[扫码登录版]

## 项目简介

这是一个基于 n8n 的自动化工作流，用于实现京东平台的京豆自动签到功能。工作流通过 Puppeteer 模拟浏览器操作，实现自动登录、签到和结果通知。

## 主要功能

1. **自动签到**：自动执行京东京豆签到操作
2. **二维码登录**：通过二维码方式实现用户登录
3. **结果通知**：通过飞书机器人发送签到结果通知
4. **定时执行**：支持定时触发，无需人工干预

## 工作流架构

### 节点说明

1. **定时触发器**：设置定时执行时间（默认：9:00、12:30、19:30）
2. **常量配置**：配置飞书机器人地址、WebSocket地址等参数
3. **获取Token**：获取飞书API访问令牌
4. **登录并签到**：核心节点，执行登录和签到操作
5. **判断签到结果**：根据签到结果进行分支处理
6. **成功/失败通知**：发送签到结果到飞书群

### 技术栈

- **n8n**：工作流自动化平台
- **Puppeteer**：浏览器自动化控制
- **飞书API**：消息通知服务

## 配置说明

### 前置条件

1. **Chrome浏览器**：需要安装Chrome浏览器
2. **飞书机器人**：需要配置飞书机器人并获取webhook地址
3. **飞书应用**：需要创建飞书应用并获取app_id和app_secret

### 配置步骤

#### 1. 获取Chrome WebSocket Debugger URL

**第一步**：打开命令提示符，执行以下命令（请根据实际Chrome安装路径调整）：

```bash
"C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9222 --remote-debugging-address=0.0.0.0 --user-data-dir="C:\chrome-remote-profile"
```

**第二步**：在打开的Chrome浏览器中访问：
```
http://localhost:9222/json/version
```

**第三步**：找到 `webSocketDebuggerUrl` 字段，将 `localhost` 替换为 `host.docker.internal`

**示例**：
- 替换前：`ws://localhost:9222/devtools/browser/7385d425-94be-474b-9f07-296f13d378d7`
- 替换后：`ws://host.docker.internal:9222/devtools/browser/7385d425-94be-474b-9f07-296f13d378d7`

#### 2. 配置工作流参数

在 `const` 节点中配置以下参数：

- **webSocketDebuggerUrl**：Chrome WebSocket调试地址
- **feishuRobotUrl**：飞书机器人webhook地址
- **app_id**：飞书应用ID
- **app_secret**：飞书应用密钥

#### 3. 获取飞书app_id和app_secret

**第一步**：访问飞书开发者平台：https://open.feishu.cn/

**第二步**：创建应用，获取app_id和app_secret

飞书开发文档：https://open.feishu.cn/document/server-docs/api-call-guide/calling-process/get-access-token

## 使用方法

### 1. 导入工作流

1. 在n8n中创建新工作流
2. 导入 `workflow.json` 文件
3. 配置必要的参数

### 2. 配置定时执行

工作流默认在以下时间执行：
- 上午 9:00
- 中午 12:30
- 晚上 19:30

可根据需要在定时触发器节点中修改执行时间。

### 3. 启动工作流

1. 确保所有配置参数已正确设置
2. 激活工作流
3. 工作流将按设定时间自动执行

## 执行流程

1. **定时触发** → 工作流开始执行
2. **获取Token** → 获取飞书API访问令牌
3. **登录并签到**：
   - 打开京东京豆页面
   - 检测登录状态
   - 如需登录，生成二维码并发送到飞书
   - 等待用户扫码登录（20秒）
   - 执行签到操作
   - 获取签到前后余额
4. **结果判断** → 根据签到结果选择分支
5. **发送通知** → 将签到结果发送到飞书群

## 注意事项

1. **Chrome进程**：确保Chrome浏览器以调试模式运行
2. **网络环境**：确保网络连接稳定
3. **登录状态**：首次使用需要扫码登录
4. **执行时间**：建议在用户活跃时间执行，以便及时处理登录二维码

## 故障排除

### 常见问题

1. **WebSocket连接失败**
   - 检查Chrome是否以调试模式启动
   - 确认端口9222未被占用
   - 验证Docker网络配置

2. **登录失败**
   - 检查二维码是否正常生成
   - 确认飞书通知是否正常发送
   - 延长等待时间

3. **签到失败**
   - 检查京东账号状态
   - 确认是否已过签到时间
   - 查看错误日志

### 日志查看

在n8n执行历史中查看详细日志，定位问题原因。

## 更新日志

### v1.0.0
- 初始版本发布
- 支持自动签到和结果通知
- 集成飞书机器人通知

## 贡献

欢迎提交Issue和Pull Request来改进这个工作流。

## 许可证

本项目采用MIT许可证。 

声明：本工作流仅作为学习交流使用