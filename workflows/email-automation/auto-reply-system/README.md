# 邮件自动回复系统

## 功能描述

这个工作流实现了智能邮件自动回复功能，可以根据邮件内容、发件人信息等条件自动发送相应的回复邮件，提高邮件处理效率。

## 前置条件

使用此工作流前需要准备：

- **邮箱服务**: Gmail、Outlook或其他支持IMAP/SMTP的邮箱
- **n8n邮箱节点**: 确保n8n已配置邮箱连接
- **回复模板**: 准备常用的回复邮件模板
- **关键词配置**: 定义触发自动回复的关键词和规则

## 配置说明

### 1. 导入工作流

1. 在n8n中点击 "Import from file"
2. 选择 `workflow.json` 文件
3. 导入成功后，配置邮箱连接

### 2. 配置邮箱连接

#### 接收邮件配置
- **服务**: 选择你的邮箱服务（Gmail、Outlook等）
- **邮箱地址**: 输入接收邮件的邮箱地址
- **密码/应用密码**: 输入邮箱密码或应用专用密码
- **文件夹**: 设置监控的邮件文件夹（默认为INBOX）

#### 发送邮件配置
- **SMTP服务器**: 配置SMTP服务器信息
- **发件人邮箱**: 设置自动回复的发件人邮箱
- **认证信息**: 配置SMTP认证信息

### 3. 配置回复规则

在 `config.example.json` 中定义回复规则：

```json
{
  "reply_rules": [
    {
      "keywords": ["咨询", "问题", "help"],
      "template": "感谢您的咨询，我们会在24小时内回复您。",
      "subject": "自动回复：已收到您的咨询"
    },
    {
      "keywords": ["投诉", "投诉", "complaint"],
      "template": "非常抱歉给您带来不便，我们会立即处理您的问题。",
      "subject": "自动回复：投诉已受理"
    }
  ],
  "exclude_senders": ["noreply@example.com", "system@example.com"],
  "max_replies_per_day": 50
}
```

### 4. 设置触发条件

- **检查频率**: 设置邮件检查间隔（建议5-15分钟）
- **时间范围**: 设置工作时间范围，避免非工作时间自动回复
- **重复检查**: 启用重复邮件检测，避免重复回复

## 使用示例

### 场景1：客户咨询自动回复

当收到包含"咨询"关键词的邮件时：
1. 工作流自动检测到关键词
2. 发送预设的咨询回复模板
3. 在邮件主题前添加"[自动回复]"标识
4. 记录回复日志

### 场景2：投诉邮件处理

当收到投诉相关邮件时：
1. 识别投诉关键词
2. 发送道歉和受理确认邮件
3. 创建投诉工单记录
4. 通知相关负责人

### 场景3：工作时间控制

- **工作时间**: 9:00-18:00 正常自动回复
- **非工作时间**: 发送"工作时间回复"的提示邮件
- **节假日**: 发送节假日服务说明

## 工作流说明

### 主要节点功能

1. **邮件触发器**: 定期检查新邮件
2. **条件判断**: 检查邮件是否符合自动回复条件
3. **关键词匹配**: 使用正则表达式匹配邮件内容
4. **模板处理**: 根据规则选择回复模板
5. **邮件发送**: 发送自动回复邮件
6. **日志记录**: 记录回复历史和统计信息

### 工作流程

```
邮件检查 → 条件过滤 → 关键词匹配 → 模板选择 → 邮件发送 → 日志记录
    ↓           ↓           ↓           ↓           ↓           ↓
  定时触发   排除规则   规则匹配   模板渲染   发送邮件   更新统计
```

## 故障排除

### 常见问题

**问题1：邮件无法接收**
- 检查邮箱连接配置
- 确认IMAP服务已启用
- 验证邮箱密码是否正确

**问题2：自动回复未触发**
- 检查关键词配置是否正确
- 确认邮件内容包含匹配的关键词
- 查看工作流执行日志

**问题3：重复回复问题**
- 启用重复检测功能
- 检查时间间隔设置
- 清理历史记录缓存

**问题4：邮件发送失败**
- 检查SMTP配置
- 确认发件人邮箱权限
- 验证网络连接

### 调试建议

1. **启用详细日志**: 在n8n中启用详细日志记录
2. **测试模式**: 先在小范围测试工作流功能
3. **监控统计**: 定期检查回复统计和成功率
4. **规则优化**: 根据实际使用情况调整关键词和规则

## 版本信息

- **创建日期**: 2024-01-15
- **最后更新**: 2024-01-15
- **兼容n8n版本**: 1.0.0+
- **作者**: n8n Workflow Collection

## 更新日志

### v1.0.0 (2024-01-15)
- 初始版本发布
- 支持基本的关键词匹配
- 支持邮件模板配置
- 支持工作时间控制

---

**注意**: 使用自动回复功能时，请确保遵守相关法律法规和邮件服务条款，避免被识别为垃圾邮件。 