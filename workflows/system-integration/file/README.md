# 文件处理工作流

## 概述

这是一个基于n8n的文件处理工作流，提供了完整的文件读取、处理、转换和写入功能。该工作流支持多种文件格式的处理，包括图片文件（PNG）和CSV数据文件。

## 功能特性

### 🔧 核心功能
- **文件读取**: 支持从本地磁盘读取多种格式文件
- **图片处理**: 提供图片模糊、尺寸调整、旋转等处理功能
- **数据解析**: 将二进制数据转换为可处理的JSON格式
- **数据转换**: 将处理后的数据转换为二进制文件格式
- **文件写入**: 将处理结果保存到本地磁盘
- **表单上传**: 支持用户通过Web表单上传文件

### 📁 支持的文件格式
- **图片文件**: PNG、JPG、GIF等
- **数据文件**: CSV、XML、TXT等
- **二进制文件**: 各种二进制格式

## 工作流架构

### 触发节点
1. **手动触发** (`When clicking 'Test workflow'`): 用于测试工作流
2. **表单提交** (`On form submission`): 接收用户上传的文件

### 处理流程

#### 路径1: 图片处理流程
```
手动触发 → 图片读取 → 图片处理(模糊) → 文件写入
```

#### 路径2: CSV数据处理流程
```
手动触发 → CSV文件读取 → 数据解析 → 数据转换 → 文件写入
```

#### 路径3: 表单上传处理流程
```
表单提交 → 数据解析 → 数据转换 → 文件写入
```

## 节点详解

### 1. 文件读取节点
- **功能**: 从本地磁盘读取指定文件
- **支持格式**: CSV、PNG、XML、TXT等
- **配置**: 指定文件路径和文件类型
- **注意**: 只能读取n8n部署机器上的本地文件

### 2. 图片处理节点
- **功能**: 对图片进行各种处理操作
- **支持操作**: 模糊处理、尺寸调整、旋转等
- **输入**: 图片文件数据
- **输出**: 处理后的图片数据

### 3. 数据解析节点
- **功能**: 将二进制数据转换为可处理的格式
- **支持格式**: CSV解析为JSON数组
- **用途**: 便于后续数据处理和转换

### 4. 数据转换节点
- **功能**: 将处理后的数据转换为二进制文件格式
- **支持格式**: JSON转CSV、其他二进制格式
- **用途**: 准备数据用于文件写入

### 5. 文件写入节点
- **功能**: 将处理结果保存到本地磁盘
- **文件命名**: 使用时间戳自动生成文件名
- **注意**: 只能写入到n8n部署的机器本地

## 部署说明

### Docker部署命令
```bash
docker run -it --rm --name n8n \
  --network n8n-net \
  -p 5678:5678 \
  -e N8N_RUNNERS_ENABLED=true \
  -e N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true \
  -e TZ=Asia/Shanghai \
  -v n8n_data:/home/node/.n8n \
  -v E:\\n8n_data:/home/node/n8n_data \
  docker.n8n.io/n8nio/n8n
```

### 重要配置说明
- **数据目录挂载**: `E:\\n8n_data:/home/node/n8n_data`
  - 作用: 让docker实例与宿主机共享文件数据
  - 可根据实际需求调整路径

## 使用方法

### 1. 手动测试
1. 在n8n界面中打开工作流
2. 点击"Test workflow"按钮
3. 工作流将自动处理预设的文件

### 2. 表单上传
1. 访问表单提交URL
2. 选择要上传的文件
3. 提交表单，工作流自动处理文件

### 3. 文件路径配置
- **输入文件**: `/home/node/n8n_data/test.png`、`/home/node/n8n_data/test.csv`
- **输出文件**: `/home/node/n8n_data/{{ $now }}.png`、`/home/node/n8n_data/{{ $now }}.csv`

## 技术细节

### 环境要求
- n8n版本: 最新稳定版
- 操作系统: 支持Docker的系统
- 存储空间: 根据处理文件大小确定

### 性能考虑
- 大文件处理可能需要较长时间
- 建议对超大文件进行分批处理
- 注意磁盘空间的使用情况

### 安全注意事项
- 文件路径验证，防止路径遍历攻击
- 文件类型检查，确保安全
- 权限控制，限制文件访问范围

## 扩展功能

### 可添加的功能
- 文件格式转换（如PDF转图片）
- 批量文件处理
- 文件压缩和解压
- 图片水印添加
- 数据加密和解密

### 集成可能性
- 与云存储服务集成
- 与邮件系统集成
- 与消息队列集成
- 与监控系统集成

## 故障排除

### 常见问题
1. **文件读取失败**: 检查文件路径和权限
2. **图片处理错误**: 确认图片格式支持
3. **磁盘空间不足**: 清理临时文件和输出文件
4. **权限问题**: 检查n8n容器的文件访问权限

### 日志查看
- 在n8n界面查看执行日志
- 检查Docker容器日志
- 监控系统资源使用情况

## 更新日志

### v1.0.0 (当前版本)
- 初始版本发布
- 支持基本的文件读写操作
- 支持图片处理功能
- 支持CSV数据解析
- 支持表单文件上传

## 贡献指南

欢迎提交Issue和Pull Request来改进这个工作流。

## 许可证

本项目采用MIT许可证。

---

**注意**: 此工作流仅用于演示和学习目的，在生产环境中使用前请进行充分测试。 